<!DOCTYPE html>
<html>
<body>
<h2>Teacher Dashboard</h2>
<button onclick="createSession()">Create Session</button>
<p id="link"></p>
<h3 id="status">Waiting...</h3>

<script>
let ws;
const status = document.getElementById("status");
const linkBox = document.getElementById("link");

async function createSession() {
    const res = await fetch("http://localhost:8000/create-session", {
        method: "POST"
    });
    const data = await res.json();

    linkBox.innerText = data.session_link;

    const token = new URL(data.session_link).searchParams.get("token");
    ws = new WebSocket(`ws://localhost:8000/ws?token=${token}`);

    ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);

        if (data.alert === "Proctor Alert") {
            status.style.color = "red";
            status.innerText = "Proctor Alert";
        } else if (data.emotion === "Confused") {
            status.style.color = "orange";
            status.innerText = "Student is Confused";
        } else {
            status.style.color = "green";
            status.innerText = "Student is Focused";
        }
    };
}
</script>
</body>
</html>
